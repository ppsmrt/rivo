<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rivo - Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Main container -->
  <main class="max-w-3xl mx-auto p-6 bg-white rounded shadow mt-6">
    <div id="profileHeader" class="flex items-center gap-4 mb-6">
      <!-- Profile header will be loaded dynamically -->
    </div>

    <section>
      <h2 class="text-xl font-semibold mb-4">Posts</h2>
      <div id="userPosts" class="space-y-4">
        <!-- Posts will be injected here -->
      </div>
    </section>
  </main>

  <!-- Centralized Firebase + UI logic -->
  <script type="module">
    import '/assets/js/realtime-app.js';

    import { getAuth, onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, onValue } 
      from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const auth = getAuth();
    const db = getDatabase();

    const profileHeader = document.getElementById('profileHeader');
    const userPosts = document.getElementById('userPosts');

    // Load profile info
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        profileHeader.innerHTML = `<p class="text-gray-500">Please sign in to view profile.</p>`;
        return;
      }

      const userRef = ref(db, `users/${user.uid}`);
      onValue(userRef, (snap) => {
        const data = snap.val() || {};
        profileHeader.innerHTML = `
          <img src="${data.photoURL || 'https://i.pravatar.cc/80'}" class="w-20 h-20 rounded-full">
          <div>
            <div class="text-xl font-bold">${data.displayName || user.email}</div>
            <div class="text-sm text-gray-500">${data.bio || 'No bio available'}</div>
          </div>
        `;
      });

      // Load user's posts
      const postsRef = ref(db, `posts/${user.uid}`);
      onValue(postsRef, (snap) => {
        userPosts.innerHTML = '';
        if (!snap.exists()) {
          userPosts.innerHTML = `<p class="text-gray-500">No posts yet.</p>`;
          return;
        }

        snap.forEach((childSnap) => {
          const post = childSnap.val();
          userPosts.innerHTML += `
            <div class="p-4 bg-gray-100 rounded">
              <div class="text-lg font-semibold">${post.title || 'Untitled'}</div>
              <div class="text-sm text-gray-600">${post.content || ''}</div>
            </div>
          `;
        });
      });
    });
  </script>
</body>
</html>