<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Home - My App</title>
    <link rel="stylesheet" href="/assets/css/theme.css" />
</head>
<body>

    <!-- Header -->
    <header>
        <h1>Welcome to My App</h1>
    </header>

    <!-- Posts Container -->
    <main>
        <div id="posts-container"></div>
    </main>

    <!-- JS Files -->
    <script type="module" src="/assets/js/firebase-init.js"></script>
    <script type="module" src="/assets/js/posts.js"></script>
    <script type="module" src="/assets/js/likes.js"></script>
    <script type="module" src="/assets/js/comments.js"></script>

    <!-- Page Logic -->
    <script type="module">
        import { getPosts } from '/assets/js/posts.js';
        import { toggleLike, listenForLikes } from '/assets/js/likes.js';
        import { addComment, listenForComments } from '/assets/js/comments.js';

        async function loadPosts() {
            const posts = await getPosts();
            const container = document.getElementById('posts-container');
            container.innerHTML = '';

            posts.forEach(post => {
                const postEl = document.createElement('div');
                postEl.classList.add('post');
                postEl.innerHTML = `
                    <h2>${post.title}</h2>
                    <p>${post.content}</p>
                    <button class="like-btn" data-id="${post.id}">❤️ Like</button>
                    <div class="likes-count" id="likes-${post.id}">0 Likes</div>
                    <input type="text" class="comment-input" data-id="${post.id}" placeholder="Write a comment"/>
                    <div class="comments" id="comments-${post.id}"></div>
                `;
                container.appendChild(postEl);

                // Likes
                listenForLikes(post.id, (count) => {
                    document.getElementById(`likes-${post.id}`).textContent = `${count} Likes`;
                });

                // Comments
                listenForComments(post.id, (comments) => {
                    const commentsDiv = document.getElementById(`comments-${post.id}`);
                    commentsDiv.innerHTML = '';
                    Object.values(comments).forEach(c => {
                        const commentEl = document.createElement('div');
                        commentEl.textContent = `${c.username}: ${c.text}`;
                        commentsDiv.appendChild(commentEl);
                    });
                });
            });

            // Like click events
            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', () => toggleLike(btn.dataset.id));
            });

            // Comment input events
            document.querySelectorAll('.comment-input').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && input.value.trim()) {
                        addComment(input.dataset.id, input.value.trim());
                        input.value = '';
                    }
                });
            });
        }

        loadPosts();
    </script>
</body>
</html>